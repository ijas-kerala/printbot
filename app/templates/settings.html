{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <div class="text-center">
        <h2 class="text-2xl font-bold text-gray-800">Print Settings</h2>
        <p class="text-gray-600 text-sm">{{ job.filename }}</p>
    </div>

    <form hx-post="/confirm-order/{{ job.id }}" hx-target="#main-content" class="space-y-6">

        <!-- Copies -->
        <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Copies</label>
            <div class="flex items-center space-x-4">
                <button type="button" onclick="decrement('copies')"
                    class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-xl font-bold">-</button>
                <input type="number" id="copies" name="copies" value="{{ job.copies }}"
                    class="w-20 text-center border-gray-300 rounded-md shadow-sm p-2"
                    hx-post="/update-settings/{{ job.id }}" hx-trigger="change, keyup delay:500ms"
                    hx-include="[name='is_duplex']" hx-target="#price-summary">
                <button type="button" onclick="increment('copies')"
                    class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-xl font-bold">+</button>
            </div>
        </div>

        <!-- Duplex Toggle -->
        <div class="flex items-center justify-between p-4 border rounded-lg bg-gray-50">
            <div>
                <span class="block font-medium text-gray-900">Double-sided</span>
                <span class="text-xs text-gray-500">Print on both sides</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" name="is_duplex" value="true" class="sr-only peer" {% if job.is_duplex
                    %}checked{% endif %} hx-post="/update-settings/{{ job.id }}" hx-target="#price-summary"
                    hx-include="[name='copies']">
                <div
                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                </div>
            </label>
        </div>

        <!-- Price Summary Partial -->
        <div id="price-summary" class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
            <div class="flex justify-between items-center text-sm text-gray-600">
                <span>Pages: {{ job.page_count }}</span>
                <span>x {{ job.copies }} copies</span>
            </div>
            <div class="flex justify-between items-center font-bold text-xl text-blue-600 mt-2">
                <span>Total</span>
                <span>â‚¹{{ "%.2f"|format(total_cost) }}</span>
            </div>
        </div>

        <button type="submit"
            class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition shadow-lg mt-6">
            Proceed to Payment
        </button>
    </form>
</div>

<script>
    function increment(id) {
        let el = document.getElementById(id);
        el.value = parseInt(el.value) + 1;
        el.dispatchEvent(new Event('change'));
    }

    function decrement(id) {
        let el = document.getElementById(id);
        if (parseInt(el.value) > 1) {
            el.value = parseInt(el.value) - 1;
            el.dispatchEvent(new Event('change'));
        }
    }
</script>
{% endblock %}